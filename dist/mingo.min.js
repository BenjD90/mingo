!function(n,t){"use strict";function r(n,t){j(n)&&w(t)}function e(n,t){j(n)&&w(t)}function u(n){return r(!$(n))}function i(n,t){e(n===Object(n),t)}function o(n,t){return Object.prototype.toString.call(n)==="[object "+t+"]"}function a(n){return o(n,"Boolean")}function l(n){return o(n,"String")}function s(n){return o(n,"Number")}function c(n){return o(n,"Array")}function f(n){return o(n,"Object")}function h(n){return n===Object(n)}function p(n){return o(n,"Date")}function d(n,t){return o(n,"RegExp")}function v(n,t){return o(n,"Function")}function g(n){return o(n,"Null")}function $(n){return o(n,"Undefined")}function y(n){return g(n)||$(n)}function m(n,t){return!n.includes(t)}function b(n,t){return n.includes(t)}function O(n){return!!n}function j(n){return!n}function _(n){return y(n)||c(n)&&0===n.length||f(n)&&0===Object.keys(n).length||!n}function x(n){return c(n)?n:[n]}function k(n){return Object.prototype.toString.call(n).match(/\s(\w+)/)[1].toLowerCase()}function E(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function w(n){throw new Error(n)}function A(n,t,r){if(i(n,"Cannot iterate over object of type '"+k(n)+"'"),c(n))n.forEach(t,r);else for(var e in n)E(n,e)&&t.call(r,n[e],e)}function M(n,t,r){if(c(n))return n.map(t,r);if(f(n)){for(var e,u={},i=Object.keys(n),o=0,a=i.length;a>o;o++)e=i[o],u[e]=t.call(r,n[e],e);return u}w("Input must be an Array or Object type")}function I(n,t){return n.filter(b.bind(null,t))}function S(n,t){var r=[];return on.apply(r,n),on.apply(r,t.filter(m.bind(null,n))),r}function q(n,t){e(c(n),"Input must be an Array");var r=[],u=function(n,t){for(var e=0,i=n.length;i>e;e++)c(n[e])&&(t>0||0>t)?u(n[e],Math.max(-1,t-1)):on.call(r,n[e])};return u(n,t||-1),r}function C(n,t){if(n===t)return!0;var r=k(n);if(r!==k(t))return!1;if("number"===r&&isNaN(n)&&isNaN(t))return!0;if(["date","regexp"].includes(r))return n.toString()===t.toString();if("array"===r){if(n.length===t.length&&0===n.length)return!0;if(n.length!==t.length)return!1;for(var e=0,u=n.length;u>e;e++)if(!C(n[e],t[e]))return!1}else{if(![n,t].every(f))return!1;var i=Object.keys(n),o=Object.keys(t);if(i.length!==o.length)return!1;if(i.sort(),o.sort(),!C(i,o))return!1;for(var e=0,a=i.length;a>e;e++){var l=i[e];if(!C(n[l],t[l]))return!1}}return!0}function N(n){var t={},r=[];return n.forEach(function(n){var e=K(n);E(t,e)||(r.push(n),t[e]=0)}),r}function D(n,t,r){r=r||{},r.root=r.root||B(n);var e=Z(n,t,null,r);return qn.includes(e)?In[e](n,t,r):e}function Q(n,t){return n[t]}function R(n,t,r){for(var e=t.split("."),u=n,i=0;i<e.length;i++){var o=g(e[i].match(/^\d+$/));if(o&&c(u)){if(r===!0&&0===i)return u;u=u.map(function(n){return R(n,e[i],!0)}),1===u.length&&(u=u[0])}else u=Q(u,e[i]),r=!1;if($(u))break}return u}function P(n,e){if(!$(n)){var i,o=e.split("."),a=o[0],l=1===o.length||o.slice(1).join("."),s=null!==a.match(/^\d+$/);try{if(1===o.length)if(c(n))s?(i=Q(n,a),u(i),i=[i]):(i=[],n.forEach(function(n){var t=P(n,e);$(t)||i.push(t)}),r(i.length>0));else{var f=Q(n,a);u(f),i={},i[a]=f}else if(c(n))s?(i=Q(n,a),i=P(i,l),u(i),i=[i]):(i=[],n.forEach(function(n){var t=P(n,e);$(t)||i.push(t)}),r(i.length>0));else{var f=Q(n,a);f=P(f,l),u(f),i={},i[a]=f}}catch(h){i=t}return i}}function L(n,t,r,e){var u=t.split("."),i=u[0],o=1===u.length||u.slice(1).join("."),a=/^\d+$/.test(i);if(1===u.length)r(n,i);else if(c(n)&&!a)n.forEach(function(n){L(n,t,r,e)});else{if(e===!0){var l=E(n,i);(!l||$(n[i])||g(n[i]))&&(n[i]={})}L(n[i],o,r,e)}}function U(n,t,r){L(n,t,function(n,t){n[t]=r})}function F(n,t){L(n,t,function(n,t){c(n)&&/^\d+$/.test(t)?n.splice(parseInt(t),1):f(n)&&delete n[t]})}function B(n){switch(k(n)){case"array":return n.map(function(n){return B(n)});case"object":return M(n,function(n,t){return B(n)});default:return n}}function T(n){for(var t=0;t<Un.length;t++)if(Un[t](n))return!0;return!1}function Y(n){return T(n)||!h(n)}function z(n){if(Y(n))return d(n)?{$regex:n}:{$eq:n};if(h(n)){var t=Object.keys(n),r=0===I(G(Cn),t).length;if(r)return{$eq:n};if(t.includes("$regex")){var e=n.$regex,u=n.$options||"",i="";l(e)&&(i+=e.ignoreCase||u.indexOf("i")>=0?"i":"",i+=e.multiline||u.indexOf("m")>=0?"m":"",i+=e.global||u.indexOf("g")>=0?"g":"",e=new RegExp(e,i)),n.$regex=e,delete n.$options}}return n}function J(n,t){return new Array(Math.max(t-String(n).length+1,0)).join("0")+n}function G(n){return Object.keys(Pn[n])}function H(n,t,e){for(var u,i,o,a={},l=[],s=n.length,c=0;s>c;c++)i=n[c],u=t.call(e,i,c),o=K(i),E(a,o)||(a[o]=[u,c]),l.push(B(i));return l.sort(function(n,t){var r=a[K(n)],e=a[K(t)];return r[0]<e[0]?-1:r[0]>e[0]?1:r[1]<e[1]?-1:r[1]>e[1]?1:0}),r(l.length===n.length,"sortBy must retain collection length"),l}function V(n,t,e){var u={keys:[],groups:[]},i={};return n.forEach(function(n){var r=t.call(e,n),o=K(r),a=-1;$(i[o])&&(a=u.keys.length,i[o]=a,u.keys.push(r),u.groups.push([])),a=i[o],u.groups[a].push(n)}),r(u.keys.length===u.groups.length,"Cardinality must be equal for groups and keys"),u}function W(n){return ln({"":n})+k(n)+n}function K(n){var t,r,e,u=0,i=W(n);if(0===i.length)return u;for(t=0,e=i.length;e>t;t++)r=i.charCodeAt(t),u=(u<<5)-u+r,u|=0;return u.toString()}function X(n,r,e){if(G(Nn).includes(r))return $n[r](n,e);if(f(e)){var u={};for(var i in e)if(E(e,i)&&(u[i]=X(n,i,e[i]),G(Nn).includes(i))){u=u[i],Object.keys(e).length>1&&w("Invalid $group expression '"+ln(e)+"'");break}return u}return t}function Z(n,t,u,i){if(i=i||{},i.root=i.root||B(n),G(Dn).includes(u))return An[u](n,t,i);if(G(Nn).includes(u))return n=Z(n,t,null,i),e(c(n),"Must use collection type with "+u+" operator"),$n[u](n,null,i);if(l(t)&&t.length>0&&"$"===t[0]){if(Sn.includes(t))return Mn[t](n,null,i);if(qn.includes(t))return t;var o=Sn.filter(function(n){return 0===t.indexOf(n+".")});return 1===o.length&&(o=o[0],"$$ROOT"===o&&(n=i.root),t=t.substr(o.length)),R(n,t.slice(1))}switch(k(t)){case"array":return t.map(function(t){return Z(n,t,null)});case"object":var a={};for(var s in t)if(E(t,s)&&(a[s]=Z(n,t[s],s,i),G(Dn).includes(s))){r(1===Object.keys(t).length,"Invalid aggregation expression '"+ln(t)+"'"),a=a[s];break}return a;default:return B(t)}}function nn(n){var t=n.dataset.reduce(function(n,t){return n+t},0),r=n.dataset.length||1,e=n.sampled===!0?1:0,u=t/(r-e);return Math.sqrt(n.dataset.reduce(function(n,t){return n+Math.pow(t-u,2)},0)/r)}function tn(n,t,e){return y(e)?0>t?(t=Math.max(0,n.length+t),e=n.length-t+1):(e=t,t=0):(0>t&&(t=Math.max(0,n.length+t)),r(e>0,"Invalid argument value for $slice operator. Limit must be a positive number"),e+=t),an.apply(n,[t,e])}var rn,en={};en.VERSION="0.9.2",null!==n&&(rn=n.Mingo),en.noConflict=function(){return n.Mingo=rn,en};var un=t!==module&&"undefined"!=typeof require;un?module!==t&&(module.exports=en):n.Mingo=en;var on=Array.prototype.push,an=Array.prototype.slice,ln=JSON.stringify;!function(){Function.prototype.bind||(Function.prototype.bind=function(n){"function"!=typeof this&&w("Function.prototype.bind - what is trying to be bound is not callable");var t=an.call(arguments,1),r=this,e=function(){},u=function(){return r.apply(this instanceof e?this:n,t.concat(an.call(arguments)))};return this.prototype&&(e.prototype=this.prototype),u.prototype=new e,u}),Array.prototype.includes||(Array.prototype.includes=function(n){null===this&&w("Array.prototype.includes called on null or undefined");var t=Object(this),r=parseInt(t.length,10)||0;if(0===r)return!1;var e,u=parseInt(arguments[1],10)||0;u>=0?e=u:(e=r+u,0>e&&(e=0));for(var i;r>e;){if(i=t[e],n===i||n!==n&&i!==i)return!0;e++}return!1}),Array.prototype.find||(Array.prototype.find=function(n){null===this&&w("Array.prototype.find called on null or undefined"),v(n)||w("predicate must be a function");for(var r,e=Object(this),u=e.length>>>0,i=arguments[1],o=0;u>o;o++)if(r=e[o],n.call(i,r,o,e))return r;return t}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(n){null==this&&w("Array.prototype.findIndex called on null or undefined"),"function"!=typeof n&&w("predicate must be a function");for(var t,r=Object(this),e=r.length>>>0,u=arguments[1],i=0;e>i;i++)if(t=r[i],n.call(u,t,i,r))return i;return-1},enumerable:!1,configurable:!1,writable:!1}),Object.keys||(Object.keys=function(n){i(n,"Object.keys called on a non-object");var t=[];for(var r in n)E(n,r)&&t.push(r);return t}),Object.values||(Object.values=function(n){i(n,"Object.values called on a non-object");var t=[];for(var r in n)E(n,r)&&t.push(n[r]);return t}),Object.assign||(Object.assign=function(n){(g(n)||$(n))&&w("Cannot convert undefined or null to object");for(var t=Object(n),r=1;r<arguments.length;r++){var e=arguments[r];if(!$(e)&&!g(e))for(var u in e)E(e,u)&&(t[u]=e[u])}return t})}();var sn={key:"_id"};if(en._internal=function(){return{assert:r.bind(null),computeValue:Z.bind(null),each:A.bind(null),falsey:j.bind(null),flatten:q.bind(null),groupBy:V.bind(null),has:E.bind(null),inArray:b.bind(null),intersection:I.bind(null),isArray:c.bind(null),isBoolean:a.bind(null),isDate:p.bind(null),isEmpty:_.bind(null),isEqual:C.bind(null),isFunction:v.bind(null),isNull:g.bind(null),isNumber:s.bind(null),isObject:f.bind(null),isObjectLike:h.bind(null),isRegExp:d.bind(null),isString:l.bind(null),isUndefined:$.bind(null),isUnknown:y.bind(null),resolve:R.bind(null),resolveObj:P.bind(null),slice:tn.bind(null),stringify:ln.bind(null),map:M.bind(null),notInArray:m.bind(null),sortBy:H.bind(null),truthy:O.bind(null),union:S.bind(null),unique:N.bind(null)}},en.setup=function(n){Object.assign(sn,n||{})},en.Query=function(n,t){return this instanceof en.Query?(this._criteria=n,this._projection=t,this._compiled=[],void this._compile()):new en.Query(n,t)},en.Query.prototype={_compile:function(){if(!_(this._criteria)){e(f(this._criteria),"Criteria must be of type Object");for(var n in this._criteria)if(E(this._criteria,n)){var t=this._criteria[n];if(["$and","$or","$nor","$where"].includes(n))this._processOperator(n,n,t);else{t=z(t);for(var r in t)E(t,r)&&this._processOperator(n,r,t[r])}}}},_processOperator:function(n,t,r){G(Cn).includes(t)?this._compiled.push(pn[t](n,r)):w("Invalid query operator '"+t+"' detected")},test:function(n){for(var t=0;t<this._compiled.length;t++)if(!this._compiled[t].test(n))return!1;return!0},find:function(n,t){return new en.Cursor(n,this,t)},remove:function(n){for(var t=[],r=0;r<n.length;r++)this.test(n[r])||t.push(n[r]);return t}},un){var cn=require("stream").Transform,fn=require("util");en.Query.prototype.stream=function(n){return new en.Stream(this,n)},en.Stream=function(n,t){return this instanceof en.Stream?(t=t||{},Object.assign(t,{objectMode:!0}),cn.call(this,t),void(this._query=n)):new en.Stream(n,t)},fn.inherits(en.Stream,cn),en.Stream.prototype._transform=function(n,t,r){if(f(n)&&this._query.test(n))if(_(this._query._projection))this.push(n);else{var e=new en.Cursor([n],this._query);e.hasNext()&&this.push(e.next())}r()}}en.Cursor=function(n,t,r){return this instanceof en.Cursor?(this._query=t,this._collection=n,this._projection=r||t._projection,this._operators={},this._result=!1,void(this._position=0)):new en.Cursor(n,t,r)},en.Cursor.prototype={_fetch:function(){var n=this;if(this._result!==!1)return this._result;f(this._projection)&&Object.assign(this._operators,{$project:this._projection}),c(this._collection)||w("Input collection is not of valid type. Must be an Array."),this._result=this._collection.filter(this._query.test,this._query);var t=[];if(["$sort","$skip","$limit","$project"].forEach(function(r){if(E(n._operators,r)){var e={};e[r]=n._operators[r],t.push(e)}}),t.length>0){var r=new en.Aggregator(t);this._result=r.run(this._result,this._query)}return this._result},all:function(){return this._fetch()},first:function(){return this.count()>0?this._fetch()[0]:null},last:function(){return this.count()>0?this._fetch()[this.count()-1]:null},count:function(){return this._fetch().length},skip:function(n){return Object.assign(this._operators,{$skip:n}),this},limit:function(n){return Object.assign(this._operators,{$limit:n}),this},sort:function(n){return Object.assign(this._operators,{$sort:n}),this},next:function(){return this.hasNext()?this._fetch()[this._position++]:null},hasNext:function(){return this.count()>this._position},max:function(n){return $n.$max(this._fetch(),n)},min:function(n){return $n.$min(this._fetch(),n)},map:function(n){return this._fetch().map(n)},forEach:function(n){this._fetch().forEach(n)}},en.Aggregator=function(n){return this instanceof en.Aggregator?void(this._operators=n):new en.Aggregator(n)},en.Aggregator.prototype={run:function(n,t){if(!_(this._operators))for(var r=0;r<this._operators.length;r++){var e=this._operators[r],u=Object.keys(e);if(1===u.length&&G(Qn).includes(u[0])){u=u[0];var i={pipelineOp:u};n=t instanceof en.Query?hn[u].call(t,n,e[u],i):hn[u](n,e[u],i)}else w("Invalid aggregation operator '"+u+"'")}return n}},en.find=function(n,t,r){return new en.Query(t).find(n,r)},en.remove=function(n,t){return new en.Query(t).remove(n)},en.aggregate=function(n,t){return c(t)||w("Aggregation pipeline must be an array"),new en.Aggregator(t).run(n)},en.addOperators=function(n,t){var e=t({resolve:R,computeValue:Z,ops:G,key:function(){return sn.key}});r([Dn,Nn,Qn,Rn,Cn].includes(n),"Could not identify type '"+n+"'");var u=G(n);Object.keys(e).forEach(function(t){r(/^\$\w+$/.test(t),"Invalid operator name '"+t+"'"),r(!u.includes(t),"Operator "+t+" is already defined for "+n+" operators")});var i={};switch(n){case Cn:Object.keys(e).forEach(function(n){i[n]=function(t,r){return function(e,u){return{test:function(i){var o=R(i,e),l=t.call(r,e,o,u);return a(l)?l:l instanceof en.Query?l.test(i):void w("Invalid return type for '"+n+"'. Must return a Boolean or Mingo.Query")}}}}(e[n],e)});break;case Rn:Object.keys(e).forEach(function(n){i[n]=function(n,t){return function(r,e,u){var i=R(r,u);return n.call(t,u,i,e)}}(e[n],e)});break;default:Object.keys(e).forEach(function(n){i[n]=function(n,t){return function(){var r=an.call(arguments);return n.apply(t,r)}}(e[n],e)})}Object.assign(Pn[n],i)},en.CollectionMixin={query:function(n,t){return en.find(this.toJSON(),n,t)},aggregate:function(n){return en.aggregate.call(null,this.toJSON(),n)}};var hn={$addFields:function(n,t){var e=Object.keys(t);return n.map(function(n){return n=B(n),e.forEach(function(e){var u,i=t[e];if(f(i)){var o=Object.keys(i),a=o.filter(function(n){return 0===n.indexOf("$")});_(a)||(r(1===o.length,"Can have only one root operator in $addFields"),a=a[0],i=i[a],u=Z(n,i,a))}else u=Z(n,i,null);L(n,e,function(n,t){n[t]=u},!0)}),n})},$group:function(n,t){var r=t[sn.key],e=V(n,function(n){return Z(n,r,r)}),u=[];return delete t[sn.key],e.keys.forEach(function(n,r){var i={};$(n)||(i[sn.key]=n);for(var o in t)E(t,o)&&(i[o]=X(e.groups[r],o,t[o]));u.push(i)}),u},$match:function(n,t){return new en.Query(t).find(n).all()},$project:function(n,t){if(_(t))return n;for(var e=[],u=Object.keys(t),i=!1,o=[!1,!1],a=0;a<u.length;a++){var c=u[a],h=t[c];c!==sn.key&&(0===h||h===!1?o[0]=!0:o[1]=!0,r(o[0]!==o[1],"Projection cannot have a mix of inclusion and exclusion."))}if(u.includes(sn.key)){var p=t[sn.key];0!==p&&p!==!1||(u=u.filter(m.bind(null,[sn.key])),r(!u.includes(sn.key),"Must not contain collections _id"),i=_(u))}else u.push(sn.key);for(var a=0;a<n.length;a++){var d=n[a],v={},g=!1,y=!1,b=[];i&&b.push(sn.key),u.forEach(function(n){var r,e,u=t[n];if(n!==sn.key&&0===u&&(y=!0),n===sn.key&&_(u))r=d[n];else if(l(u))r=Z(d,u,n);else if(1===u||u===!0);else{if(!f(u))return void b.push(n);var i=Object.keys(u);i=i.length>1?!1:i[0],G(Rn).includes(i)?"$slice"===i?x(u[i]).every(s)?(r=gn[i](d,u[i],n),g=!0):r=Z(d,u,n):r=gn[i](d,u[i],n):r=Z(d,u,n)}r=B(r),e=B(P(d,n)),$(e)?$(r)||(v[n]=r):($(r)||U(e,n,r),Object.assign(v,e))}),(g||y||i)&&(v=Object.assign(B(d),v),b.forEach(function(n){F(v,n)})),e.push(v)}return e},$limit:function(n,t){return n.slice(0,t)},$skip:function(n,t){return n.slice(t)},$unwind:function(n,t){for(var r=[],e=t.substr(1),u=0;u<n.length;u++){var i=n[u],o=Q(i,e);c(o)?o.forEach(function(n){var t=B(i);t[e]=n,r.push(t)}):w("Target field '"+e+"' is not of type Array.")}return r},$sort:function(n,t){if(!_(t)&&f(t)){var r=Object.keys(t);r.reverse().forEach(function(r){var e=V(n,function(n){return R(n,r)}),u={},i=function(n){return u[K(n)]},o=H(e.keys,function(n,t){return u[K(n)]=t,n});-1===t[r]&&o.reverse(),n=[],o.forEach(function(t){on.apply(n,e.groups[i(t)])})})}return n},$sortByCount:function(n,t){var r={count:{$sum:1}};return r[sn.key]=t,this.$sort(this.$group(n,r),{count:-1})},$sample:function(n,t){var r=t.size;e(s(r),"$sample size must be a positive integer. See https://docs.mongodb.com/manual/reference/operator/aggregation/sample/");for(var u=[],i=0;r>i;i++){var o=Math.floor(Math.random()*n.length);u.push(n[o])}return u},$count:function(n,t){r(l(t)&&""!==t.trim()&&-1===t.indexOf(".")&&"$"!==t.trim()[0],"Invalid expression value for $count. See https://docs.mongodb.com/manual/reference/operator/aggregation/count/");var e={};return e[t]=n.length,e},$replaceRoot:function(n,t){var r=t.newRoot,u=[];return n.forEach(function(n){n=Z(n,r,null),e(f(n),"$replaceRoot expression must return a valid JS object. See https://docs.mongodb.com/manual/reference/operator/aggregation/replaceRoot/"),u.push(n)}),u},$redact:function(n,t){return n.map(function(n){return D(B(n),t)})}},pn={},dn={$and:function(n,t){e(c(t),"Invalid expression: $and expects value to be an Array");var r=[];return t.forEach(function(n){r.push(new en.Query(n))}),{test:function(n){for(var t=0;t<r.length;t++)if(!r[t].test(n))return!1;return!0}}},$or:function(n,t){c(t)||w("Invalid expression for $or criteria");var r=[];return t.forEach(function(n){r.push(new en.Query(n))}),{test:function(n){for(var t=0;t<r.length;t++)if(r[t].test(n))return!0;return!1}}},$nor:function(n,t){c(t)||w("Invalid expression for $nor criteria");var r=this.$or("$or",t);return{test:function(n){return!r.test(n)}}},$not:function(n,t){var r={};r[n]=z(t);var e=new en.Query(r);return{test:function(n){return!e.test(n)}}},$where:function(n,t){return v(t)||(t=new Function("return "+t+";")),{test:function(n){return t.call(n)===!0}}}};Object.assign(pn,dn);var vn={$eq:function(n,t){return C(n,t)||c(n)&&-1!==n.findIndex(C.bind(null,t))},$ne:function(n,t){return!this.$eq(n,t)},$in:function(n,t){return n=x(n),I(n,t).length>0},$nin:function(n,t){return $(n)||!this.$in(n,t)},$lt:function(n,r){return n=x(n).find(function(n){return r>n}),n!==t},$lte:function(n,r){return n=x(n).find(function(n){return r>=n}),n!==t},$gt:function(n,r){return n=x(n).find(function(n){return n>r}),n!==t},$gte:function(n,r){return n=x(n).find(function(n){return n>=r}),n!==t},$mod:function(n,r){return n=x(n).find(function(n){return s(n)&&c(r)&&2===r.length&&n%r[0]===r[1]}),n!==t},$regex:function(n,r){return n=x(n).find(function(n){return l(n)&&d(r)&&!!n.match(r)}),n!==t},$exists:function(n,t){return t===!1&&$(n)||t===!0&&!$(n)},$all:function(n,t){var r=this,e=!1;if(c(n)&&c(t))for(var u=0;u<t.length;u++){if(!f(t[u])||!Object.keys(t[u]).includes("$elemMatch"))return I(t,n).length===t.length;e=e||r.$elemMatch(n,t[u].$elemMatch)}return e},$size:function(n,t){return c(n)&&s(t)&&n.length===t},$elemMatch:function(n,t){if(c(n)&&!_(n))for(var r=new en.Query(t),e=0;e<n.length;e++)if(r.test(n[e]))return!0;return!1},$type:function(n,t){switch(t){case 1:return s(n)&&-1!==(n+"").indexOf(".");case 2:case 5:return l(n);case 3:return f(n);case 4:return c(n);case 8:return a(n);case 9:return p(n);case 10:return g(n);case 11:return d(n);case 16:return s(n)&&2147483647>=n&&-1===(n+"").indexOf(".");case 18:return s(n)&&n>2147483647&&0x8000000000000000>=n&&-1===(n+"").indexOf(".");default:return!1}}};Object.keys(vn).forEach(function(n){pn[n]=function(n,t){return function(r,e){return{test:function(u){var i=R(u,r);return n.call(t,i,e)}}}}(vn[n],vn)});var gn={$:function(n,t,r){w("$ not implemented")},$elemMatch:function(n,r,e){var u=R(n,e),i=new en.Query(r);if($(u)||!c(u))return t;for(var o=0;o<u.length;o++)if(i.test(u[o]))return[u[o]];return t},$slice:function(n,t,r){var e=R(n,r);return c(e)?c(t)?tn(e,t[0],t[1]):s(t)?tn(e,t):void w("Invalid argument type for $slice projection operator"):e},$stdDevPop:function(n,t,r){var e=Z(n,t,r);return nn({dataset:e,sampled:!1})},$stdDevSamp:function(n,t,r){var e=Z(n,t,r);return nn({dataset:e,sampled:!0})}},$n={$addToSet:function(n,t){return N(this.$push(n,t))},$sum:function(n,t){return c(n)?s(t)?n.length*t:this.$push(n,t).filter(s).reduce(function(n,t){return n+t},0):0},$max:function(n,t){var r,e=this.$push(n,t);return e.length>0&&(r=e[0],e.forEach(function(n){n>r&&(r=n)})),r},$min:function(n,t){var r,e=this.$push(n,t);return e.length>0&&(r=e[0],e.forEach(function(n){r>n&&(r=n)})),r},$avg:function(n,t){var r=this.$push(n,t).filter(s),e=r.reduce(function(n,t){return n+t},0);return e/(r.length||1)},$push:function(n,t){return g(t)?B(n):n.map(function(n){return Z(n,t,null)})},$first:function(n,r){return n.length>0?Z(n[0],r):t},$last:function(n,r){return n.length>0?Z(n[n.length-1],r):t},$stdDevPop:function(n,t){var r=this.$push(n,t).filter(s);return nn({dataset:r,sampled:!1})},$stdDevSamp:function(n,t){var r=this.$push(n,t).filter(s);return nn({dataset:r,sampled:!0})}},yn={$abs:function(n,r){var e=Z(n,r,null);return null===e||e===t?null:Math.abs(e)},$add:function(n,t){var r=Z(n,t,null);return r.reduce(function(n,t){return n+t},0)},$subtract:function(n,t){var r=Z(n,t,null);return r[0]-r[1]},$divide:function(n,t){var r=Z(n,t,null);return r[0]/r[1]},$multiply:function(n,t){var r=Z(n,t,null);return r.reduce(function(n,t){return n*t},1)},$mod:function(n,t){var r=Z(n,t,null);return r[0]%r[1]}},mn={$concat:function(n,r){var e=Z(n,r,null);return[null,t].some(b.bind(null,e))?null:e.join("")},$indexOfBytes:function(n,t){var u=Z(n,t,null);if(y(u[0]))return null;e(l(u[0]),"$indexOfBytes first operand must resolve to a string"),e(l(u[1]),"$indexOfBytes second operand must resolve to a string");var i=u[0],o=u[1],a=u[2],c=u[3];if(r($(a)||s(a)&&a>=0&&Math.round(a)===a,"$indexOfBytes third operand must resolve to a non-negative integer"),a=a||0,r($(c)||s(c)&&c>=0&&Math.round(c)===c,"$indexOfBytes fourth operand must resolve to a non-negative integer"),c=c||i.length,a>c)return-1;var f=i.substring(a,c).indexOf(o);return f>-1?f+a:f},$split:function(n,t){var r=Z(n,t,null);return e(l(r[0]),"$split requires an expression that evaluates to a string as a first argument, found: "+k(r[0])),e(l(r[1]),"$split requires an expression that evaluates to a string as a second argument, found: "+k(r[1])),r[0].split(r[1])},$strcasecmp:function(n,t){var r=Z(n,t,null);return r[0]=_(r[0])?"":r[0].toUpperCase(),r[1]=_(r[1])?"":r[1].toUpperCase(),r[0]>r[1]?1:r[0]<r[1]?-1:0},$substr:function(n,t){var r=Z(n,t,null);return l(r[0])?r[1]<0?"":r[2]<0?r[0].substr(r[1]):r[0].substr(r[1],r[2]):""},$toLower:function(n,t){var r=Z(n,t,null);return _(r)?"":r.toLowerCase()},$toUpper:function(n,t){var r=Z(n,t,null);return _(r)?"":r.toUpperCase()}},bn={$dayOfYear:function(n,r){var e=Z(n,r,null);if(p(e)){var u=new Date(e.getFullYear(),0,0),i=e-u,o=864e5;return Math.round(i/o)}return t},$dayOfMonth:function(n,r){var e=Z(n,r,null);return p(e)?e.getDate():t},$dayOfWeek:function(n,r){var e=Z(n,r,null);return p(e)?e.getDay()+1:t},$year:function(n,r){var e=Z(n,r,null);return p(e)?e.getFullYear():t},$month:function(n,r){var e=Z(n,r,null);return p(e)?e.getMonth()+1:t},$week:function(n,t){var r=Z(n,t,null);r=new Date(+r),r.setHours(0,0,0),r.setDate(r.getDate()+4-(r.getDay()||7));var e=new Date(r.getFullYear(),0,1);return Math.floor(((r-e)/864e5+1)/7)},$hour:function(n,r){var e=Z(n,r,null);return p(e)?e.getHours():t},$minute:function(n,r){var e=Z(n,r,null);return p(e)?e.getMinutes():t},$second:function(n,r){var e=Z(n,r,null);return p(e)?e.getSeconds():t},$millisecond:function(n,r){var e=Z(n,r,null);return p(e)?e.getMilliseconds():t},$dateToString:function(n,t){for(var r=t.format,e=Z(n,t.date,null),u=r.match(/(%%|%Y|%m|%d|%H|%M|%S|%L|%j|%w|%U)/g),i=0,o=u.length;o>i;i++){var a=Ln[u[i]],l=a;if(c(a)){var s=this[a[0]],f=a[1];l=J(s.call(this,n,e),f)}r=r.replace(u[i],l)}return r}},On={$setEquals:function(n,t){var r=Z(n,t,null),e=N(r[0]),u=N(r[1]);return e.length===u.length&&e.length===I(e,u).length},$setIntersection:function(n,t){var r=Z(n,t,null);return I(r[0],r[1])},$setDifference:function(n,t){var r=Z(n,t,null);return r[0].filter(m.bind(null,r[1]))},$setUnion:function(n,t){var r=Z(n,t,null);return S(r[0],r[1])},$setIsSubset:function(n,t){var r=Z(n,t,null);return I(r[0],r[1]).length===r[0].length},$anyElementTrue:function(n,t){var r=Z(n,t,null)[0];return r.some(O)},$allElementsTrue:function(n,t){var r=Z(n,t,null)[0];return r.every(O)}},jn={$cond:function(n,t){var r,e,u;c(t)?(3!=t.length&&w("Invalid arguments for $cond operator"),r=t[0],e=t[1],u=t[2]):f(t)&&(r=t["if"],e=t.then,u=t["else"]);var i=Z(n,r,null);return i?Z(n,e,null):Z(n,u,null)},$switch:function(n,t){t.branches||w("Invalid arguments for $switch operator");var r=t.branches.find(function(t){return t["case"]&&t.then||w("Invalid arguments for $switch operator"),Z(n,t["case"],null)});return r?Z(n,r.then,null):t["default"]?Z(n,t["default"],null):void w("Invalid arguments for $switch operator")},$ifNull:function(n,e){r(c(e)&&2===e.length,"Invalid arguments for $ifNull operator");var u=Z(n,e,null);return null===u[0]||u[0]===t?u[1]:u[0]}},_n={$cmp:function(n,t){var r=Z(n,t,null);return r[0]>r[1]?1:r[0]<r[1]?-1:0}};["$eq","$ne","$gt","$gte","$lt","$lte","$in","$nin"].forEach(function(n){_n[n]=function(t,r){var e=Z(t,r,null);return vn[n](e[0],e[1])}});var xn={$arrayElemAt:function(n,u){var i=Z(n,u,null);r(c(i)&&2===i.length,"$arrayElemAt expression must resolve to an array of 2 elements"),e(c(i[0]),"First operand to $arrayElemAt must resolve to an array"),e(s(i[1]),"Second operand to $arrayElemAt must resolve to an integer");var o=i[1];return i=i[0],0>o&&Math.abs(o)<=i.length?i[o+i.length]:o>=0&&o<i.length?i[o]:t},$concatArrays:function(n,t){var e=Z(n,t,null);return r(c(e)&&2===e.length,"$concatArrays expression must resolve to an array of 2 elements"),g(e[0])||g(e[1])||$(e[0])||$(e[1])?null:e[0].concat(e[1])},$filter:function(n,t){var r=Z(n,t.input,null),u=t.as,i=t.cond;return e(c(r),"'input' expression for $filter must resolve to an array"),r.filter(function(n){var t={};return t["$"+u]=n,Z(t,i,null)===!0})},$indexOfArray:function(n,t){var r=Z(n,t,null);if(y(r))return null;var u=r[0];if(y(u))return null;e(c(u),"First operand for $indexOfArray must resolve to an array.");var i=r[1];if(y(i))return null;var o=r[2]||0,a=r[3]||u.length;return a<u.length&&(u=u.slice(o,a)),u.indexOf(i,o)},$isArray:function(n,t){return c(Z(n,t,null))},$range:function(n,t){for(var r=Z(n,t,null),e=r[0],u=r[1],i=r[2]||1,o=[];u>e&&i>0||e>u&&0>i;)o.push(e),e+=i;return o},$reverseArray:function(n,t){var r=Z(n,t,null);return y(r)?null:(e(c(r),"$reverseArray expression must resolve to an array"),r=B(r),r.reverse(),r)},$reduce:function(n,t){var r=Z(n,t.input,null),u=Z(n,t.initialValue,null),i=t["in"];return y(r)?null:(e(c(r),"'input' expression for $reduce must resolve to an array"),r.reduce(function(n,t){return Z({$value:n,$this:t},i,null)},u))},$size:function(n,r){var e=Z(n,r,null);return c(e)?e.length:t},$slice:function(n,t){var r=Z(n,t,null);return tn(B(r[0]),r[1],r[2])},$zip:function(n,t){var u=Z(n,t.inputs,null),i=t.useLongestLength||!1;e(c(u),"'inputs' expression must resolve to an array"),e(a(i),"'useLongestLength' must be a boolean"),c(t.defaults)&&r(O(i),"'useLongestLength' must be set to true to use 'defaults'");for(var o=0,l=0;l<u.length;l++){var s=u[l];if(y(s))return null;e(c(s),"'inputs' expression values must resolve to an array or null"),o=i?Math.max(o,s.length):Math.min(o||s.length,s.length)}for(var f=[],h=t.defaults||[],l=0;o>l;l++){var s=u.map(function(n,t){return y(n[l])?h[t]||null:n[l]});f.push(s)}return f}},kn={$literal:function(n,t){return t}},En={$map:function(n,t){var r=Z(n,t.input,null);c(r)||w("Input expression for $map must resolve to an array");var e=t.as,u=t["in"],i="$"+e,o=n[i];return r.map(function(t){n[i]=t;var r=Z(n,u,null);return $(o)?delete n[i]:n[i]=o,r})},$let:function(n,t){var r=t.vars,e=t["in"],u={},i=Object.keys(r);i.forEach(function(t){var e=Z(n,r[t],null),i="$"+t;u[i]=n[i],n[i]=e});var o=Z(n,e,null);return i.forEach(function(t){var r="$"+t;$(u[r])?delete n[r]:n[r]=u[r]}),o}},wn={$and:function(n,t){var r=Z(n,t,null);return O(r)&&r.every(O)},$or:function(n,t){var r=Z(n,t,null);return O(r)&&r.some(O)},$not:function(n,t){return!Z(n,t[0],null)}},An=Object.assign({},xn,yn,wn,_n,jn,bn,kn,On,mn,En),Mn={$$ROOT:function(n,t,r){return r.root},$$CURRENT:function(n,t,r){return n}},In={$$KEEP:function(n,t,r){return n},$$PRUNE:function(n,r,e){return t},$$DESCEND:function(n,t,r){if(!E(t,"$cond"))return n;var e;return A(n,function(u,i){h(u)&&(c(u)?(e=[],u.forEach(function(n,u){f(n)&&(n=D(n,t,r)),$(n)||e.push(n)})):e=D(u,t,r),$(e)?delete n[i]:n[i]=e)}),n}},Sn=Object.keys(Mn),qn=Object.keys(In),Cn=en.OP_QUERY="query",Nn=en.OP_GROUP="group",Dn=en.OP_AGGREGATE="aggregate",Qn=en.OP_PIPELINE="pipeline",Rn=en.OP_PROJECTION="projection",Pn={aggregate:An,group:$n,pipeline:hn,projection:gn,query:pn},Ln={"%Y":["$year",4],"%m":["$month",2],"%d":["$dayOfMonth",2],"%H":["$hour",2],"%M":["$minute",2],"%S":["$second",2],"%L":["$millisecond",3],"%j":["$dayOfYear",3],"%w":["$dayOfWeek",1],"%U":["$week",2],"%%":"%"},Un=[l,a,s,p,g,d,$]}(this);
//# sourceMappingURL=dist/mingo.min.map